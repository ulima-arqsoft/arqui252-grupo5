> [4. Decisiones Iniciales de Arquitectura](../../4.md) ‚Ä∫ [4.6. Listado Consolidado](../4.6.md) ‚Ä∫ [4.6.6. Mapeo entre Elementos de Arquitectura](4.6.6.md)

# 4.6.6. Mapeo entre Elementos de Arquitectura

### Decisi√≥n 1:

**T√≠tulo**  
- De dominios funcionales a servicios desplegables (1 a 1, con Gateway en el borde)

**Contexto**  
- Los m√≥dulos cubren dominios claros: autenticaci√≥n/usuarios, generaci√≥n de playlist, suscripciones/pagos, preferencias, e integraciones con Spotify (y futuros). Necesitamos un mapeo estable de ‚Äúqu√© hace qui√©n‚Äù para desplegar y escalar sin pisarnos.

**Alternativas**  
- A) Un solo backend monol√≠tico con ‚Äúcarpetas‚Äù por m√≥dulo.  
- B) Microservicios muy finos por cada caso de uso.  
- C) **Servicios por dominio (bounded context) + API Gateway** que orquesta entradas.

**Criterios de Elecci√≥n**  
- Separaci√≥n de responsabilidades clara.  
- Escalado independiente en picos distintos (login vs. generaci√≥n vs. pagos).  
- Facilidad de evoluci√≥n por equipo responsable.

**Decisi√≥n**  
- **C) Mapear cada dominio a un servicio propio** y exponerlos detr√°s de un **API Gateway**:  
  - **Auth & Users Service** (registro/login, perfil, sesiones, consentimientos).  
  - **Playlist Service** (emoci√≥n‚Üífeatures, seeds, snapshots, re-generaci√≥n).  
  - **Subscriptions/Billing Service** (planes, cobros, dunning, facturaci√≥n).  
  - **Preferences Service** (filtros, duraci√≥n, √©pocas, variabilidad, sync).  
  - **Integrations Service** (Spotify v1; capa agn√≥stica a futuros proveedores).  
  - **Notifications Service** (emails, push).  

**Sustento**  
- Cada equipo trabaja su servicio con independencia y SLIs propios.  
- Permite aislar fallas (ej. Spotify) y escalar donde duele sin encarecer todo el backend.

---

### Decisi√≥n 2:

**T√≠tulo**  
- De servicios a propiedad de datos (database-per-service con proyecciones de solo lectura)

**Contexto**  
- GDPR/privacidad, auditor√≠a y rendimiento exigen que los datos tengan **due√±o claro**. Evitamos un ‚Äús√∫per esquema‚Äù compartido que frena a todos.

**Alternativas**  
- A) Un √∫nico esquema compartido entre todos los servicios.  
- B) Un data lake central y los servicios consumen todo desde all√≠.  
- C) **Base de datos por servicio (propiedad exclusiva) + vistas/proyecciones para lectura.**

**Criterios de Elecci√≥n**  
- Autonom√≠a de cambios de esquema.  
- Menos acoplamiento y menor riesgo en migraciones.  
- Claridad de cumplimiento (borrado/retenci√≥n por dominio).

**Decisi√≥n**  
- **C) Asignar tablas/colecciones por servicio y publicar proyecciones de solo lectura cuando otro dominio necesita consultar**:  
  - **Auth & Users**: `users`, `session_tokens`, `consent_logs`, `audit_logs`.  
  - **Playlist**: `playlist_snapshots`, `seed_tracks`, `generation_runs`.  
  - **Subscriptions/Billing**: `plans`, `subscriptions`, `invoices`, `payments`.  
  - **Preferences**: `user_settings`, `genres_weights`, `feature_profiles`.  
  - **Integrations**: `provider_links`, `oauth_tokens`, `sync_jobs`.  
  - **Notifications**: `message_queue_out`, `delivery_logs`.  

**Sustento**  
- Cambios en un dominio no rompen a los dem√°s; cada equipo gobierna su esquema.  
- Las proyecciones evitan consultas cruzadas ‚Äúen vivo‚Äù y mantienen el rendimiento.

---

### Decisi√≥n 3:

**T√≠tulo**  
- De interacciones a canales y contratos (REST s√≠ncrono para UX, eventos para coordinaci√≥n)

**Contexto**  
- Algunas llamadas deben responder **ya** (login, ver perfil, pre-escucha); otras coordinan a varios servicios (p. ej., crear playlist y exportarla) y conviene **desacoplar**.

**Alternativas**  
- A) Todo por REST s√≠ncrono entre servicios.  
- B) Solo mensajer√≠a/eventos para todo.  
- C) **Mixto:** REST para UX inmediata; **eventos** para coordinaci√≥n entre dominios.

**Criterios de Elecci√≥n**  
- Tiempo de respuesta al usuario.  
- Tolerancia a fallas externas (Spotify, pagos).  
- Simplicidad de contratos.

**Decisi√≥n**  
- **C) Mapear interacciones a:**  
  - **REST/HTTP (s√≠ncrono)** para operaciones directas de UI: login, recuperar contrase√±a, leer perfil y preferencias, pre-escucha, crear playlist (inicio), ver estado de suscripci√≥n.  
  - **Eventos/Mensajer√≠a (as√≠ncrono)** para orquestar pasos y notificar cambios:  
    - T√≥picos sugeridos: `user.created`, `consent.updated`, `playlist.generated`, `playlist.export.requested`, `subscription.changed`, `payment.succeeded/failed`, `sync.failed`, `profile.updated`.  
  - **Contratos simples** (JSON) y **idempotency-key** en operaciones sensibles.

**Sustento**  
- La UI obtiene respuestas r√°pidas, mientras los procesos largos siguen por detr√°s sin bloquear.  
- Los eventos permiten reintentos, compensaciones y trazabilidad entre m√≥dulos.

---

[‚¨ÖÔ∏è Anterior](../4.6.4/4.6.4.md) | [üè† Home](../../../README.md)