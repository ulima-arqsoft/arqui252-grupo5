> [4. Decisiones Iniciales de Arquitectura](../4.md) ‚Ä∫ [4.4. M√≥dulo Gesti√≥n de Preferencias de Usuario / Ana Meza](4.4.md)

# 4.4. Gesti√≥n de Preferencias de Usuario / Ana Meza

### Decisiones de Asignaci√≥n de Responsabilidades

### Decisi√≥n 1:

**T√≠tulo**
- Separaci√≥n del m√≥dulo de Preferencias como microservicio independiente (Preferences Service)

**Contexto**
- Las preferencias (tema, idioma, notificaciones opt-in/out, calidad de reproducci√≥n, layouts, accesibilidad, etc.) requieren baja latencia de lectura, versionado y trazabilidad por usuario y por dispositivo.

- Mezclarlas con perfil o autenticaci√≥n dificulta el escalamiento y la evoluci√≥n de esquemas sin afectar dominios cr√≠ticos.

**Alternativas**
- Incluir preferencias dentro de User Profile Service.

- Persistir preferencias en el cliente y sincronizarlas de forma best-effort.

**Criterios de Elecci√≥n**
- Aislamiento de cambios de esquema sin impactar otros dominios.

- Escalabilidad de lecturas (read-heavy) y cach√© espec√≠fica.

- Auditor√≠a (historial de cambios) y reversi√≥n (rollbacks) por usuario/dispositivo.

**Decisi√≥n**
- **Crear un microservicio Preferences Service con su propio datastore y API, responsable de CRUD, versionado y auditor√≠a de preferencias.**

**Sustento**
- Reduce el acoplamiento con Perfil y Auth, permite escalar lecturas con cach√© y soporta evoluci√≥n r√°pida de claves/valores y estructuras anidadas sin riesgo al resto del sistema.

--

### Decisi√≥n 2:

**T√≠tulo**
- Modelo de datos h√≠brido: key-value tipado + esquema normalizado para preferencias sensibles

**Contexto**
- La mayor√≠a de preferencias son simples (key-value) y cambian con frecuencia; otras (p. ej., consentimientos de tracking por categor√≠a) requieren integridad, referencialidad y cumplimiento normativo.

**Alternativas**
- Todo key-value en documento.

- Todo relacional normalizado.

- Enfoque h√≠brido: documento key-value tipado para ajustes generales + tablas normalizadas para √°mbitos regulados.

**Criterios de Elecci√≥n**
- Flexibilidad para nuevas claves sin migraciones costosas.
- Garant√≠as de integridad y auditor√≠a para preferencias reguladas.
- Rendimiento en lecturas masivas y filtros por √°mbito.

**Decisi√≥n**
- **Usar almacenamiento documental (p. ej., JSON) para claves generales con tipado y validaci√≥n de esquema; y tablas relacionales para consentimientos y flags sujetos a normativa.**

**Sustento**
- Permite velocidad de cambio donde importa (UI/UX) y control estricto donde se exige (privacidad, auditor√≠a).

---

### Decisi√≥n 3:

**T√≠tulo**
- Jerarqu√≠a y reglas de resoluci√≥n de preferencias (global, app, tenant, usuario, dispositivo)

**Contexto**
- Un usuario puede tener m√∫ltiples dispositivos y pertenecer a distintos tenants/espacios. Las preferencias se aplican por √°mbito y deben resolverse determin√≠sticamente.

**Alternativas**
- Solo nivel usuario.
- Solo nivel dispositivo.
- Jerarqu√≠a con herencia y precedencia configurables.

**Criterios de Elecci√≥n**
- Experiencia consistente entre dispositivos con posibilidad de overrides locales.
- Simplicidad para el cliente (SDK) y trazabilidad del valor efectivo.
- Idempotencia y reproducibilidad ante auditor√≠a.

**Decisi√≥n**
- **Definir jerarqu√≠a de resoluci√≥n: default global ‚Üí app ‚Üí tenant/espacio ‚Üí usuario ‚Üí dispositivo. El valor efectivo y su fuente se devuelven en cada respuesta.**

**Sustento**
- Evita ambig√ºedades, facilita depuraci√≥n y permite pol√≠ticas corporativas por tenant sin bloquear preferencias personales.

---

### Decisiones de Modelo de Datos



---

### Decisiones de Elecci√≥n de Tecnolog√≠a



---

### Decisiones de Tiempo de Enlace



---

[‚¨ÖÔ∏è Anterior](../4.3/4.3.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../4.5/4.5.md)