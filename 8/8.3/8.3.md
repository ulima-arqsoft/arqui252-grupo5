> [8. Aplicaci√≥n de Patrones Arquitecturales](../8.md) ‚Ä∫ [8.3. M√≥dulo 3 / Integrante 3](8.3.md)

# 8.3. M√≥dulo 3 / Integrante 3

## 1. Patrones de M√≥dulo

# Decision 1

## **T√≠tulo**
Uso de una arquitectura en capas para separar presentaci√≥n, l√≥gica de negocio y acceso a datos en el m√≥dulo de planes y suscripciones.

## **Contexto**
El m√≥dulo de Gesti√≥n de Planes y Suscripciones requiere manejar l√≥gica sensible relacionada a pagos, historial, renovaciones, cancelaciones y auditor√≠as.  
Para cumplir los requisitos **ESC-10**, **ESC-11** y **ESC-12** se necesita:

- seguridad estricta  
- tiempos de respuesta bajos  
- trazabilidad de operaciones  
- capacidad de extender reglas de negocio sin romper otras partes del sistema  

Una arquitectura clara y estructurada es necesaria para asegurar mantenibilidad a largo plazo.

## **Alternativas**

### Descomposiciones Espec√≠ficas (por funcionalidad o por flujo)
- Mejor adaptaci√≥n a flujos particulares (por ejemplo: ‚Äúprocesar pago‚Äù o ‚Äúrenovar plan‚Äù).
- M√°s flexible pero m√°s dif√≠cil de estandarizar. 
- Mayor complejidad al mantener consistencia y seguridad transaccional.

### Arquitectura en capas (presentaci√≥n ‚Äì negocio ‚Äì persistencia)
- La l√≥gica de suscripci√≥n se a√≠sla del control de pagos y de la base de datos.  
- Facilita validaciones, auditor√≠a y escalado independiente.

## **Criterios de Elecci√≥n**
- Separaci√≥n clara de responsabilidades.  
- Extensi√≥n de reglas de negocio sin romper controladores.  
- Facilitar pruebas unitarias.  
- Reducir riesgos en operaciones cr√≠ticas.

## **Decisi√≥n**
Se selecciona la **arquitectura en capas** para estructurar el m√≥dulo.

## **Sustento**
Permite encapsular la l√≥gica de negocio en una capa independiente, ideal para manejar reglas complejas.  
Adem√°s, aporta orden, facilita pruebas y soporta futuras ampliaciones e integraciones.

## 2. Patrones de Componente y Conector

# Decision 2

## **T√≠tulo**
Estructurar la interacci√≥n entre frontend y backend bajo el patr√≥n Cliente-Servidor.

## **Contexto**
El m√≥dulo debe permitir que los usuarios consulten planes, paguen y vean su historial desde cualquier dispositivo.  
El backend centraliza seguridad, validaci√≥n y comunicaci√≥n con Stripe por **ESC-10** y **ESC-11**.

## **Alternativas**

### Arquitectura peer-to-peer
- No centraliza seguridad.  
- Riesgos altos en transacciones financieras.

### Cliente-Servidor
- El cliente solicita datos.  
- El backend controla autenticaci√≥n, validaci√≥n y l√≥gica cr√≠tica.

## **Criterios de Elecci√≥n**
- Centralizar seguridad.  
- Simplificar validaci√≥n de pagos y tokens.  
- Garantizar trazabilidad.  
- Respuesta < 2 s (ESC-11).

## **Decisi√≥n**
Se adopta el patr√≥n **Cliente-Servidor**.

## **Sustento**
Permite que el backend gestione las interacciones con Stripe de manera segura, manteniendo integridad y consistencia.  
Simplifica protecci√≥n PCI-DSS. 

# Decision 3

## **T√≠tulo**
Uso del patr√≥n Publicar‚ÄìSuscribir para manejar eventos internos y webhooks de Stripe de forma as√≠ncrona.

## **Contexto**
ESC-11 exige tiempos de respuesta < 2 segundos.  
Stripe env√≠a eventos como:

- cobro exitoso  
- pago fallido  
- disputa creada  
- cancelaci√≥n autom√°tica  

Estos eventos no deben bloquear el flujo principal ni saturar la API.

## **Alternativas**

### Procesamiento s√≠ncrono dentro del endpoint
- Aumenta latencia.  
- Riesgo de timeouts.  
- Mala trazabilidad.

### Publicar‚ÄìSuscribir
- El backend publica eventos.  
- Servicios internos los consumen.  
- A√≠sla la API de tareas lentas.

## **Criterios de Elecci√≥n**
- Reducir latencia.  
- Manejo robusto de eventos externos.  
- Mejor trazabilidad.  
- Flexibilidad para nuevos eventos.

## **Decisi√≥n**
Se adopta **Publicar‚ÄìSuscribir**.

## **Sustento**
Desacopla la API del procesamiento de eventos, garantizando respuestas r√°pidas y auditor√≠a completa.  
Ayuda a manejar cobros duplicados o errores detectados por soporte.

## 3. Patrones de Asignaci√≥n

# Decision 4

## **T√≠tulo**
Separaci√≥n del sistema en m√∫ltiples niveles: frontend, backend y servicios externos (Stripe).

## **Contexto**
El m√≥dulo involucra:  
- Interfaz de usuario  
- Backend con reglas  
- Stripe para pagos  
- Base de datos para historial  

Para cumplir PCI-DSS se requiere separaci√≥n l√≥gica y f√≠sica.

## **Alternativas**

### Todo en un servidor
- Riesgos altos de seguridad.  
- Dif√≠cil aislamiento de fallos.  
- No cumple PCI-DSS.

### Multi-Tier
- A√≠sla responsabilidades y entornos.  
- Mejora control y monitoreo.

## **Criterios de Elecci√≥n**
- Aislamiento f√≠sico para pagos.  
- Cumplimiento de seguridad.  
- Escalabilidad independiente.  
- Tolerancia a fallos.

## **Decisi√≥n**
Se adopta el patr√≥n **Multi-Tier**.

## **Sustento**
Permite separar presentaci√≥n, backend, base de datos y Stripe, mejorando resiliencia, seguridad y crecimiento modular.


## 4. Patrones Cloud

# Decision 5

## **T√≠tulo**
Uso del patr√≥n Circuit Breaker para proteger la API cuando Stripe presenta fallas.

## **Contexto**
Stripe puede fallar por:

- sobrecarga  
- ca√≠das regionales  
- latencia  

Si el backend espera en cada intento:  
- se satura  
- rompe ESC-11 (>2 s)  
- puede duplicar cobros  
- genera reclamos (ESC-12)

## **Alternativas**

### Retry con Exponential Backoff
- √ötil, pero puede aumentar latencia.  
- Riesgo de duplicar operaciones.

### Circuit Breaker
- Supervisa fallos consecutivos.  
- Bloquea temporalmente peticiones al servicio externo.  
- Evita saturaci√≥n.

## **Criterios de Elecci√≥n**
- Mantener respuestas r√°pidas.  
- Evitar cascadas de error.  
- Reducir cobros duplicados.  
- Aumentar estabilidad.

## **Decisi√≥n**
Se implementa **Circuit Breaker** entre backend y Stripe.

## **Sustento**
Evita llamadas repetidas cuando Stripe est√° inestable, protege al backend y mejora resiliencia del sistema.

---

[‚¨ÖÔ∏è Anterior](../8.2/8.2.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../8.4/8.4.md)