> [6. Documentaci√≥n de Arquitectura (Bosquejo)](../6.md) ‚Ä∫ [6.4. Otras Vistas](6.4.md)

# 6.4. Otras Vistas

CODIGO STRUCTURIZ:

workspace "Lyra - Arquitectura General + Pagos" "C4 completo" {

  model {

    # ===============================
    #        PERSONAS
    # ===============================
    user_final = person "Usuario Final" "Usa la app Lyra para generar playlists por emoci√≥n."
    admin_soporte = person "Administrador / Soporte" "Administra la plataforma."

    # ===============================
    #     SOFTWARE SYSTEM PRINCIPAL
    # ===============================
    lyra = softwareSystem "Lyra Platform" "Plataforma que detecta emoci√≥n, genera playlists y gestiona pagos." {

      # ===============================
      #            CONTAINERS
      # ===============================

      frontend = container "Frontend App" "Flutter" "UI m√≥vil del usuario."

      api_gateway = container "API Gateway" "Node.js" "Routing, JWT, Zero Trust."

      # --- Microservicio de Preferencias
      ms_pref = container "Microservicio de Preferencias del Usuario" "NestJS" "Preferencias, canciones favoritas."
      db_pref = container "Base de Datos de Preferencias y Canciones" "MongoDB" "Almacena preferencias, ratings."

      # --- Microservicio de Planes y Suscripciones (REEMPLAZA AL DE PAGOS)
      ms_planes = container "Microservicio de Planes y Suscripciones" "NestJS" "Procesa pagos, planes, intents y suscripciones." {

        component "StripeController"  "Controller que crea PaymentIntents y recibe webhooks."
        component "PaymentsController" "Expone historial de pagos y suscripciones."
        component "StripeService" "Integraci√≥n con Stripe + Circuit Breaker."
        component "PaymentsService" "Registra y consulta pagos y renovaciones."
        component "PaymentRepository" "TypeORM Repository para MySQL."
      }

      db_planes = container "Base de Datos de Planes y Pagos" "MySQL" "Planes, precios, suscripciones e historial."

      # --- Microservicio de Generaci√≥n de Playlists
      ms_playlist = container "Microservicio de Generaci√≥n de Playlists" "NestJS" "Genera playlists personalizadas."

      # --- Microservicio de Gesti√≥n de Usuarios
      ms_usuarios = container "Microservicio de Gesti√≥n de Usuarios" "NestJS" "Login, datos del usuario."
      db_usuarios = container "Base de Datos de Usuarios" "PostgreSQL" "Almacena datos del usuario."

      # --- Microservicio de Conexi√≥n Externa
      ms_external = container "Microservicio de Conexi√≥n con Plataformas Externas" "NestJS" "Env√≠a playlists a Spotify / Apple."
    }

    # ===============================
    #        SISTEMAS EXTERNOS
    # ===============================
    idp_auth = softwareSystem "IdP / Autenticaci√≥n" "Login, sesiones, 2FA."
    spotify_api = softwareSystem "Spotify API" "Proveedor de m√∫sica externo."
    apple_api = softwareSystem "Apple Music API" "Proveedor externo de m√∫sica."
    stripe = softwareSystem "Stripe" "Procesamiento de pagos externo."

    # ===============================
    #          RELACIONES
    # ===============================

    # Personas
    user_final -> frontend "Usa la app"
    admin_soporte -> lyra "Opera y monitorea"

    # Flujo general
    frontend -> api_gateway "Solicita datos y funciones"

    api_gateway -> ms_pref "Preferencias de usuario"
    api_gateway -> ms_planes "Consulta planes, pagos y suscripciones"
    api_gateway -> ms_playlist "Generaci√≥n de playlists"
    api_gateway -> ms_usuarios "Autenticaci√≥n y datos de usuario"
    api_gateway -> ms_external "Exportaci√≥n de playlists"

    # Bases de datos
    ms_playlist -> db_pref "Lee preferencias para generacion de playlists"
    ms_pref -> db_pref "Lee/Escribe preferencias"
    ms_planes -> db_planes "Lee/Escribe planes y pagos"
    ms_usuarios -> db_usuarios "Lee/Escribe datos del usuario"

    # Servicios Externos
    ms_external -> spotify_api "Env√≠a playlists"
    ms_external -> apple_api "Env√≠a playlists"
    lyra -> idp_auth "Autenticaci√≥n"
    ms_planes -> stripe "Crea PaymentIntents"
    stripe -> ms_planes "Webhook de confirmaci√≥n"

  }

  # ===============================
  #                VISTAS
  # ===============================

  views {

    systemContext lyra {
      include *
      autoLayout
    }

    container lyra {
      include *
      autoLayout
    }

    component ms_planes {
      include *
      autoLayout
    }

    styles {
      element "Person" {
        background "#08427b"
        color "#ffffff"
      }
      element "SoftwareSystem" {
        background "#1168bd"
        color "#ffffff"
      }
      element "ExternalSystem" {
        background "#dddddd"
        color "#000000"
      }
      element "Container" {
        background "#438dd5"
        color "#ffffff"
      }
      element "Component" {
        background "#85bbff"
        color "#000000"
      }
    }
  }
}

---

[‚¨ÖÔ∏è Anterior](../6.3/6.3.md) | [üè† Home](../../README.md)