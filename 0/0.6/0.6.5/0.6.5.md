> [0. Acerca del Grupo](../../0.md) ‚Ä∫ [0.6. Temas Individuales (Parte 1)](../0.6.md) ‚Ä∫ [0.6.5. Integrante 5](0.6.5.md)

# 0.6.5. Andrew Tamayo
---
# üåê Desarrollo Conceptual ‚Äî Integraci√≥n de APIs de Terceros

## ‚úÖ ¬øQu√© es?
La **integraci√≥n de APIs de terceros** es el conjunto de pr√°cticas y t√©cnicas que permiten **conectar, consumir y coordinar** servicios externos en una aplicaci√≥n mediante **interfaces de programaci√≥n** estandarizadas. Funciona de forma **reactiva**: defines las *fuentes de datos* (p. ej., "clima de OpenWeatherMap + fotos de Unsplash") y la aplicaci√≥n las **orquesta**, gestionando autenticaci√≥n, transformaci√≥n de datos, manejo de errores y estrategias de *fallback*.

### üîó ¬øQu√© es una API?
Una **API** (Application Programming Interface) es un **conjunto de especificaciones** que define c√≥mo dos sistemas se comunican:
- **Endpoint**: URL espec√≠fica que expone funcionalidad.
- **M√©todo HTTP**: GET, POST, PUT, DELETE para diferentes operaciones.
- **Formato de datos**: JSON, XML o binario para intercambio.
- **Autenticaci√≥n**: API keys, OAuth, JWT para control de acceso.
- Habilita **separaci√≥n de responsabilidades** y **reutilizaci√≥n** al exponer servicios como componentes modulares.

---

## üåü ¬øPor qu√© integrar APIs de terceros?
- **Aceleraci√≥n del desarrollo** (no reinventar funcionalidades complejas).
- **Acceso a datos especializados** (clima, geolocalizaci√≥n, fotograf√≠as, finanzas).
- **Funcionalidades avanzadas** sin expertise interna (ML, mapas, pagos).
- **Escalabilidad** aprovechando infraestructura externa robusta.
- **Reducci√≥n de costos** vs desarrollo interno completo.
- **Innovaci√≥n r√°pida** combinando m√∫ltiples servicios especializados.

---

## üü© Cu√°ndo conviene
- **Datos en tiempo real** que requieren fuentes autoritativas (clima, precios).
- **Funcionalidades complejas** como mapas, an√°lisis de im√°genes, traducciones.
- **Prototipado r√°pido** y validaci√≥n de conceptos (*MVPs*).
- **Aplicaciones compuestas** que necesitan m√∫ltiples fuentes de datos.
- **Equipos peque√±os** que buscan m√°xima productividad.

## üü• Cu√°ndo *no* conviene
- **Datos cr√≠ticos** donde la dependencia externa es inaceptable.
- **Requisitos de latencia ultra-baja** donde cada *roundtrip* cuenta.
- **Costos por volumen** que superan el desarrollo interno a largo plazo.
- **Regulaciones estrictas** que proh√≠ben compartir datos con terceros.

---

## Desaf√≠os y riesgos (a gestionar)
- **Dependencias externas** y puntos de falla fuera de control.
- **Cambios en APIs** (versionado, depreciaci√≥n, t√©rminos de servicio).
- **L√≠mites de rate limiting** y quotas que afectan disponibilidad.
- **Costos variables** por uso que pueden escalar inesperadamente.
- **Latencia acumulada** por m√∫ltiples llamadas en serie/paralelo.
- **Seguridad**: exposici√≥n de API keys y datos sensibles en tr√°nsito.

---

## Componentes y conceptos clave
| Capa | Qu√© hace | Ejemplos |
|---|---|---|
| **Cliente HTTP** | Realiza peticiones y maneja respuestas | Fetch API, Axios, HTTPClient |
| **Autenticaci√≥n** | Gestiona credenciales y tokens | API Keys, OAuth 2.0, JWT |
| **Transformaci√≥n** | Adapta datos entre formatos | JSON parsing, data mapping |
| **Cache** | Reduce latencia y llamadas | LocalStorage, Redis, CDN |
| **Gesti√≥n de errores** | Maneja fallos y reintenta | Retry logic, circuit breaker |
| **Fallbacks** | Alternativas cuando servicios fallan | Datos por defecto, APIs backup |
| **Monitoreo** | Observa rendimiento y disponibilidad | Logs, m√©tricas, alertas |

---

## Patrones t√≠picos de integraci√≥n
| Patr√≥n | Qu√© resuelve | Ejemplo |
|---|---|---|
| **Agregaci√≥n** | Combina datos de m√∫ltiples fuentes | Dashboard de clima + fotos + mapas |
| **Proxy/Gateway** | Centraliza acceso y aplica pol√≠ticas | API Gateway que enruta a servicios |
| **Cache-aside** | Reduce latencia y costo por llamada | Guarda respuestas por TTL |
| **Circuit Breaker** | Previene cascada de fallos | Abre circuito si 5 fallos en 1min |
| **Retry con backoff** | Reintenta operaciones fallidas | 3 intentos con delay exponencial |
| **Fallback en cascada** | M√∫ltiples alternativas ordenadas | API1 ‚Üí API2 ‚Üí Cache local ‚Üí Default |
| **Webhooks** | Notificaciones as√≠ncronas | Callback cuando cambia estado |

---

## Estrategias de consumo
| Estrategia | √ösala cuando‚Ä¶ | Trade-off |
|---|---|---|
| **S√≠ncrono** | Datos necesarios para continuar | Bloquea UI; experiencia lineal |
| **As√≠ncrono** | Mejora de UX opcional | Mayor complejidad; estados intermedios |
| **Batch** | M√∫ltiples operaciones agrupadas | Eficiente; menor granularidad |
| **Streaming** | Datos continuos en tiempo real | Baja latencia; mayor complejidad |
| **Polling** | Verificaci√≥n peri√≥dica de cambios | Simple; ineficiente para cambios raros |

---

## M√©tricas clave de integraci√≥n
- **Disponibilidad** por API y **tasa de error** (2xx vs 4xx/5xx).
- **Latencia** P50/P95/P99 por endpoint y regi√≥n.
- **Throughput** (requests/segundo) y **rate limiting** restante.
- **Costo** por llamada y proyecci√≥n mensual por API.
- **Cache hit ratio** y **tiempo de respuesta** con/sin cache.
- **Cobertura de fallback** ante fallos de APIs primarias.

---

## Glosario r√°pido
- **REST**: estilo arquitect√≥nico con recursos y m√©todos HTTP est√°ndar.
- **Rate limiting**: l√≠mite de requests por per√≠odo (ej: 1000/hora).
- **API key**: token de autenticaci√≥n simple y est√°tica.
- **OAuth**: protocolo de autorizaci√≥n delegada (login con Google/GitHub).
- **Webhook**: HTTP callback para notificaciones push.
- **CORS**: pol√≠tica de navegador para requests cross-origin.
- **SDK**: librer√≠a que simplifica consumo de API espec√≠fica.

> **Nota:** Este marco es **agn√≥stico de tecnolog√≠a** (JavaScript, Python, Java, etc.). La demo del repositorio implementar√° un **Weather Dashboard** que integra 5 APIs diferentes con estrategias de fallback robustas.

## **DEMO**
## Implementaci√≥n Pr√°ctica de Patrones de Integraci√≥n de APIs

Esta secci√≥n explica c√≥mo cada elemento del **Weather Dashboard** implementa los conceptos te√≥ricos de **Integraci√≥n de APIs de Terceros**.

---

## **Patrones Implementados**

### **1. Agregaci√≥n de APIs**
```javascript
// Funci√≥n que orquesta m√∫ltiples APIs
async function cargarAPIsAdicionales(countryCode, ciudad) {
  // 1. REST Countries API
  const countryRes = await fetch(`https://restcountries.com/v3.1/alpha/${countryCode}`);
  
  // 2. Fotos de ciudad (m√∫ltiples fuentes)
  await cargarFotoRealCiudad(ciudad, cityPhotoDiv);
  
  // 3. Noticias simuladas (patr√≥n de datos por defecto)
  newsInfoDiv.innerHTML = formatearNoticias(noticiasDemo);
}
```
**Concepto**: Combina datos de m√∫ltiples fuentes para crear una vista unificada.

### **2. Fallback en Cascada**
```javascript
// Sistema de 5 niveles de fallback para im√°genes
const imageUrls = [
  `https://source.unsplash.com/800x400/?${ciudad}+city`,       // Nivel 1
  `https://source.unsplash.com/collection/1114848/800x400/`,    // Nivel 2
  await buscarConMultiplesAPIs(ciudad),                         // Nivel 3
  `https://maps.googleapis.com/maps/api/staticmap?...`,         // Nivel 4
  mostrarFallbackCiudad(ciudad)                                 // Nivel 5
];
```
**Concepto**: M√∫ltiples alternativas ordenadas por confiabilidad.

### **3. Retry con Timeout**
```javascript
function verificarImagenConTimeout(url, timeout = 5000) {
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => resolve(true);
    img.onerror = () => resolve(false);
    setTimeout(() => resolve(false), timeout);  // Timeout 5s
    img.src = url;
  });
}
```
**Concepto**: Control de tiempo de respuesta y manejo de fallos.

---

## **APIs Integradas y Estrategias**

### **API Principal: OpenWeatherMap**
```javascript
// 4 endpoints diferentes de la misma API
const endpoints = {
  current: `/weather?q=${ciudad}&appid=${apiKey}`,
  forecast: `/forecast?q=${ciudad}&appid=${apiKey}`,
  uv: `/uvi?lat=${lat}&lon=${lon}&appid=${apiKey}`,
  air: `/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`
};
```
**Estrategia**: Consumo s√≠ncrono secuencial con manejo de errores por endpoint.

### **API de Respaldo: Google Static Maps**
```javascript
if (googleMapsKey && googleMapsKey !== 'TU_API_KEY_DE_GOOGLE_AQUI') {
  const mapUrl = `https://maps.googleapis.com/maps/api/staticmap?...`;
  const valida = await verificarImagenConTimeout(mapUrl, 3000);
}
```
**Estrategia**: Verificaci√≥n de disponibilidad antes de usar API de costo.

### **APIs Gratuitas: Unsplash + REST Countries**
```javascript
// Sin l√≠mites estrictos, uso directo
const countryRes = await fetch(`https://restcountries.com/v3.1/alpha/${countryCode}`);
const photoUrl = `https://source.unsplash.com/800x400/?${termino}`;
```
**Estrategia**: Consumo directo con fallback visual.

---

## **Gesti√≥n de Errores Implementada**

### **Por Capas**
```javascript
try {
  // Capa 1: Validaci√≥n de entrada
  if (!ciudad) throw new Error("Ciudad requerida");
  
  // Capa 2: Llamada a API
  const response = await fetch(apiUrl);
  if (!response.ok) throw new Error(`HTTP ${response.status}`);
  
  // Capa 3: Procesamiento de datos
  const data = await response.json();
  
} catch (error) {
  // Capa 4: Manejo graceful
  console.error('Error:', error);
  mostrarMensajeError(`Error: ${error.message}`);
}
```

### **Estados de Error Cubiertos**
- ‚ùå **Red no disponible** ‚Üí Mensaje informativo
- ‚ùå **API key inv√°lida** ‚Üí Error espec√≠fico
- ‚ùå **Ciudad no encontrada** ‚Üí Sugerencias
- ‚ùå **L√≠mite de API excedido** ‚Üí Usar fallbacks
- ‚ùå **Timeout de respuesta** ‚Üí Reintentar o fallback

---

## **M√©tricas Observables**

### **En Consola del Navegador**
```javascript
console.log(`üîç Buscando foto REAL para: ${ciudad}`);
console.log(`‚úÖ Imagen encontrada con URL ${i + 1}`);
console.log(`‚ùå Error con URL ${i + 1}:`, error);
console.log(`‚è∞ Timeout para imagen: ${url.substring(0, 50)}...`);
```

### **M√©tricas Implementadas**
- **Disponibilidad**: % de APIs que responden exitosamente
- **Latencia**: Tiempo desde request hasta renderizado
- **Fallback usage**: Frecuencia de uso de cada nivel
- **Cache hit**: Im√°genes cargadas vs verificadas

---

## **UX y Estados de Carga**

### **Loading States**
```javascript
// Estado inicial
currentWeatherDiv.innerHTML = '<p>üîÑ Cargando datos del clima...</p>';

// Estados espec√≠ficos por secci√≥n
cityPhotoDiv.innerHTML = `
  <div style="...">
    <div style="font-size: 24px;">üîÑ</div>
    <h3>Cargando vista de ${ciudad}...</h3>
  </div>
`;
```

### **Estados de Error**
```javascript
function mostrarError(mensaje) {
  return `
    <div style="color: #e74c3c; text-align: center; padding: 20px;">
      <h3>‚ö†Ô∏è ${mensaje}</h3>
      <p>Verifica tu conexi√≥n e int√©ntalo de nuevo</p>
    </div>
  `;
}
```

---

## **Gesti√≥n Segura de Credenciales**

### **Separaci√≥n de Configuraci√≥n**
```json
// src/config/config.json
{
  "weather_api": "caae8d5db64b5aff305849a58be910ae",
  "google_maps_api": "AIzaSyCAbxNe8U61I91MMNUm9qas9snS18KAOAg"
}
```

### **Carga As√≠ncrona**
```javascript
async function cargarConfig() {
  const res = await fetch("src/config/config.json");
  return res.json();
}
```
**Beneficios**: No hardcoded en c√≥digo fuente, f√°cil rotaci√≥n de keys.

---

## **Escalabilidad y Mantenimiento**

### **Modularizaci√≥n**
```
src/js/
‚îú‚îÄ‚îÄ app-final.js     # Orquestaci√≥n principal
‚îî‚îÄ‚îÄ utils.js         # Transformaci√≥n de datos
```

### **Extensibilidad**
- ‚ûï **Nueva API**: Agregar en `cargarAPIsAdicionales()`
- ‚ûï **Nuevo fallback**: A√±adir nivel en array de `imageUrls`
- ‚ûï **Nueva m√©trica**: Extender logging en funciones existentes

### **Configuraci√≥n Sin C√≥digo**
- API keys en JSON externo
- URLs base centralizadas
- Timeouts configurables

---

## **Checklist de Buenas Pr√°cticas Implementadas**

- ‚úÖ **Separaci√≥n de configuraci√≥n** (API keys en archivo externo)
- ‚úÖ **Manejo de errores granular** (por tipo y API)
- ‚úÖ **Fallbacks robustos** (5 niveles para im√°genes)
- ‚úÖ **Timeouts configurables** (evitar cuelgues)
- ‚úÖ **Estados de carga** (UX durante requests)
- ‚úÖ **Logging estructurado** (debug en consola)
- ‚úÖ **Validaci√≥n de entrada** (ciudad requerida)
- ‚úÖ **Transformaci√≥n de datos** (APIs ‚Üí UI)
- ‚úÖ **Reutilizaci√≥n** (funciones modulares)
- ‚úÖ **Escalabilidad** (f√°cil agregar nuevas APIs)

---

> **Conclusi√≥n**: El Weather Dashboard implementa un **ecosistema completo** de integraci√≥n de APIs que demuestra todos los conceptos te√≥ricos de manera pr√°ctica y robusta, desde patterns b√°sicos hasta estrategias avanzadas de resilencia y UX.

## Demo C√≥digo

Link de Github del Proyecto:
https://github.com/ZtAdriaN/DEMO-INTEGRACION-DE-APIS-DE-TERCEROS.git



[‚¨ÖÔ∏è Anterior](../0.6.4/0.6.4.md) | [üè† Home](../../../README.md)