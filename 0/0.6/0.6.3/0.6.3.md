> [0. Acerca del Grupo](../../0.md) ‚Ä∫ [0.6. Temas Individuales (Parte 1)](../0.6.md) ‚Ä∫ [0.6.3. Integrante 3](0.6.3.md)

# 0.6.3. Leonardo Salazar
# Desarrollo Conceptual de Observabilidad y Monitoreo

## 1. ¬øQu√© es la observabilidad y monitoreo?

La **observabilidad** es una t√°ctica de calidad que permite comprender el estado interno de un sistema a partir de la informaci√≥n que este genera ‚Äîcomo *logs*, *m√©tricas* y *trazas*‚Äî. En otras palabras, mide qu√© tan ‚Äúvisible‚Äù es el comportamiento interno del sistema sin necesidad de modificarlo o detenerlo.

El **monitoreo**, por su parte, consiste en el proceso de recopilar, analizar y visualizar esa informaci√≥n para detectar fallos, degradaciones de rendimiento o comportamientos an√≥malos.  

Mientras la observabilidad busca ofrecer visibilidad, el monitoreo busca acci√≥n y respuesta ante lo observado.

En conjunto, ambas t√°cticas forman la base de la gesti√≥n proactiva de sistemas distribuidos, permitiendo detectar incidentes antes de que afecten al usuario final y facilitando el diagn√≥stico r√°pido cuando ocurren errores.

---

## 2. Origen y contexto

El concepto de **observabilidad** proviene de la teor√≠a de control formulada por *Rudolf K√°lm√°n* en la d√©cada de 1960, donde se defin√≠a como la capacidad de inferir el estado interno de un sistema din√°mico a partir de sus salidas observables.

En el √°mbito del **software moderno**, esta idea se adapt√≥ al contexto de las **arquitecturas distribuidas y microservicios**, donde los componentes est√°n aislados y la visibilidad global se vuelve un reto.  
As√≠, la observabilidad se convirti√≥ en un principio clave para la **confiabilidad operativa (Site Reliability Engineering o SRE)**.

Actualmente, las soluciones de observabilidad abarcan tres pilares fundamentales:

- **Logs:** registros detallados de eventos o errores.  
- **M√©tricas:** valores num√©ricos sobre el rendimiento o estado del sistema.  
- **Trazas (Traces):** seguimiento de las solicitudes a trav√©s de m√∫ltiples servicios.

Estas herramientas permiten que un sistema no solo reaccione a fallos, sino que **aprenda de ellos** mediante alertas, paneles de control y an√°lisis post-mortem.  
Plataformas como **Sentry**, **Prometheus**, **Grafana** o **Elastic APM** integran estos conceptos para ofrecer una visi√≥n completa del ciclo de vida del software.

---

## 3. Ventajas y desventajas

| **Ventajas** | **Desventajas** |
|---------------|------------------|
| Permite detectar y diagnosticar errores en tiempo real. | Requiere configuraci√≥n y mantenimiento continuo de las herramientas. |
| Mejora la confiabilidad y rendimiento del sistema. | Puede generar sobrecarga de datos o costos por almacenamiento de logs y trazas. |
| Facilita el seguimiento de errores desde el frontend hasta el backend. | La integraci√≥n inicial puede ser compleja en entornos distribuidos. |
| Proporciona alertas autom√°ticas ante fallos o degradaci√≥n del servicio. | Un mal manejo de datos sensibles podr√≠a comprometer la privacidad si no se filtran correctamente. |

---
## 4. Aplicaci√≥n en el proyecto

En el proyecto **StoreLite**, la t√°ctica de **Observabilidad y Monitoreo** se implement√≥ utilizando **Sentry** como herramienta principal.  
Su integraci√≥n se realiz√≥ en **dos niveles del sistema**:



### Frontend (React)

- Se configur√≥ el cliente de **Sentry** en el archivo `main.jsx` para capturar errores y excepciones del navegador.  
- parte de la aplicaci√≥n est√° envuelta por un componente `ErrorBoundary`, que intercepta fallos en la interfaz y muestra un mensaje claro al usuario ‚Äîpor ejemplo:  
  > ‚ÄúHa ocurrido un error üò¢‚Äù  

  mientras el error se registra autom√°ticamente en Sentry.

Esto garantiza que el sistema sea **tolerante a fallos en la interfaz**, evitando bloqueos totales y facilitando el diagn√≥stico posterior en el panel de Sentry.

- Cada producto puede ser seleccionado por el usuario, y al presionar el bot√≥n **Buy**, se genera una nueva orden que es registrada en el backend.

- Por ultimo, se agrego un boton debajo para lanzar un error a proposito para probar la funcionalidad de Sentry


### Backend (FastAPI)

En el lado del servidor, se a√±adi√≥ el **SDK de Sentry** para capturar errores de las rutas y excepciones no controladas.

Se implement√≥ un **flujo funcional** que relaciona los **orders** con los **products**.  


Durante la validaci√≥n de este proceso se a√±adieron **manejadores de errores controlados y no controlados** para probar la eficacia del monitoreo. 

Por ejemplo, si el backend esta caido o hay un error en el formato de la orden, el sistema captura la excepci√≥n y la env√≠a autom√°ticamente a **Sentry**, junto con el **contexto de la solicitud** y los **datos enviados**.

---

De esta manera, los errores generados tanto en el **cliente** como en el **servidor** aparecen **centralizados en el panel de Sentry**, donde pueden visualizarse con su traza completa, contexto del entorno, tipo de error y los pasos que llevaron al fallo (*breadcrumbs*).

Adem√°s, **Sentry** permite definir **alertas autom√°ticas** por correo o Slack, activadas cuando se detecta un error nuevo, repetitivo o cr√≠tico, lo cual **mejora la capacidad de respuesta** y **reduce el tiempo medio de detecci√≥n de fallos (MTTD)**.

---

# Consideraciones t√©cnicas

### 1. Requisitos

Tener instalado Docker y Docker Compose. Se puede descargar a traves de este [link](https://www.docker.com/products/docker-desktop/) con la opcion "Download Docker Desktop" y seguir la condiguraci√≥n default

![Paso 1 Docker](Docker1.png)

Todos los servicios se levantan de manera autom√°tica y consistente gracias a Docker Compose, sin necesidad de instalaciones extras.

Ademas de crearte una cuenta en [Sentry](https://sentry.io/welcome/?utm_source=google&utm_medium=cpc&utm_id={20403208976}&utm_campaign=Google_Search_Brand_SentryKW_ROW_Alpha&utm_content=g&utm_term=sentry&gad_source=1&gad_campaignid=20403208976&gbraid=0AAAAADua1WJ2lcwzbUcA5mSA1J9_xTYKX&gclid=Cj0KCQjwo63HBhCKARIsAHOHV_WMxcCDFHNYLC7-G237FhXWtc--US25CYEQyTNj88bzLusSoy5mhbQaAqXFEALw_wcB) a travez de la opcion "TRY SENTRY FOR FREE"

![Paso 1 Sentry](Sentry1.png)

Una vez creada tu cuenta, te tendrias que dirigir hacia Settings - Projects - Create project

![Paso 2 Sentry](Sentry2.png)

En la creacion de proyecto selecciona las opciones mostradas en la imagen

![Paso 3 Sentry](Sentry3.png)

Una vez creado, ahora nos dirijimos hacia Insights - Projects - storelite (o el nombre que le pusiste al proyecto) - Engranaje en la esquina superior izquierda

![Paso 4 Sentry](Sentry4.png)

Luego en la barra vertical de la izquierda busca la opcion SDK Setup - Client Keys (DSN)

![Paso 5 Sentry](Sentry5.png)

Dentro de este apartado estara tu DSN que te servira para vincular cualquier implementacion a Sentry y poder empezar a hacer cosas con este.

## 2. Configuraci√≥n

Clonar el repositorio del proyecto:

```bash
git clone https://github.com/ulima-arqsoft/arqui252-grupo5.git
```

y luego entrar en la carpeta donde se encuentra el proyecto con:

```bash
cd 0/0.6/0.6.3/storelite
```

Por ultimo, se tendran que crear 2 archivos **.env**

El primero debe ir en la raiz del proyecto (storelite) y debe tener:

```bash
SENTRY_DSN="COLOCAR TU PROPIA DSN"
FRONTEND_URL=http://localhost:5173
BACKEND_URL=http://localhost:8000
```
El segundo debe ir dentro de la carpeta frontend y debe tener:

```bash
VITE_SENTRY_DSN="COLOCAR TU PROPIA DSN"
VITE_API_URL=http://localhost:8000
```
## 3. Ejecuci√≥n

Desde la carpeta ra√≠z del m√≥dulo, ejecutar:

```bash
docker-compose up
```

Esto iniciar√° autom√°ticamente los siguientes servicios:

- üóÑÔ∏è **Redis** (puerto `6379`)  
- ‚öôÔ∏è **Backend FastAPI** (puerto `8000`)  
- üíª **Frontend React** (puerto `5173`)  

La ejecuci√≥n puede visualizarse en **Docker Desktop**

![Docker Ver 1](Docker2.png)

Seleccionando el contenedor storelite se podra apreciar que todos los servicios se encuentran activos y en ejecuci√≥n.

![Docker Ver 2](Docker3.png)

---

## 4. Preparaci√≥n para pruebas

Tener abierto en el navegador: 

- [http://localhost:5173](http://localhost:5173) para tener el frontend
- [http://localhost:8000](http://localhost:8000) para tener el backend
- Sentry en Insights - Projects - storelite (o el nombre que le pusiste al proyecto) **(esta pantalla pasara a llamarse como "Detalles del proyecto" para el resto de este documento)**

---

## 5. Pruebas de observabilidad y monitoreo

|  **Objetivo** |  **Acci√≥n** |  **C√≥mo verlo en Sentry** |  **Resultado esperado** |
|-----------------|---------------|------------------------------|---------------------------|
| **1Ô∏è‚É£ Capturar error manual y excepci√≥n en backend** | Abrir en el navegador:<br>üëâ [http://localhost:8000/test/error](http://localhost:8000/test/error) | En la parte inferior de **detalles del proyecto** aparecen dos eventos:<br>- Message: ‚ÄúManual error triggered üö®‚Äù<br>- Exception: ‚ÄúSimulated error for Sentry testing!‚Äù<br>Al presionarlos se muestran sus detalles. | Sentry muestra el **stack trace** y la l√≠nea exacta del error en el c√≥digo **Python**. |
| **2Ô∏è‚É£ Error controlado desde frontend (React)** | En el frontend, hacer clic en el bot√≥n **‚ÄúProbar error‚Äù** del carrito. | En la parte inferior de **detalles del proyecto**, aparece un nuevo evento:<br>‚ÄúError manual en el render del carrito üß®‚Äù. | El frontend muestra el mensaje:<br>‚ÄúHa ocurrido un error üò¢‚Äù<br>y Sentry guarda el **stack trace de React** y la **sesi√≥n del usuario**. |
| **3Ô∏è‚É£ Capturar errores de red (Axios / Orders)** | 1Ô∏è‚É£ Tener abierto el frontend en el navegador.<br>2Ô∏è‚É£ Detener el backend desde **Docker Desktop**.<br>3Ô∏è‚É£ En el frontend, presionar **Buy** en cualquier producto. | En la parte inferior de **detalles del proyecto**, aparece un error tipo **Network / AxiosError**.<br>En ‚ÄúBreadcrumbs‚Äù se ven las peticiones HTTP previas. | Se muestra la alerta:<br>‚ùå ‚ÄúError al crear la orden...‚Äù<br>y en Sentry se registra el **fallo de red con contexto** y la **secuencia de pasos del usuario**. |
| **4Ô∏è‚É£ Capturar logs manuales del backend** | Abrir:<br>üëâ [http://localhost:8000/simulate/log](http://localhost:8000/simulate/log) | En la parte inferior de **detalles del proyecto**, se registran los mensajes enviados por el logger (**info**, **warning**, **error**). | En los **breadcrumbs del evento** se visualizan los tres niveles de log. |
| **5Ô∏è‚É£ Session Replay (reproducci√≥n de sesi√≥n)** | 1Ô∏è‚É£ Mover el mouse en la pantalla del frontend.<br>2Ô∏è‚É£ Provocar un error (clic en ‚ÄúProbar error‚Äù). | Aparece un nuevo evento de un *issue* ya existente:<br>‚ÄúError manual en el render del carrito üß®‚Äù.<br>Dentro del evento, aparece el apartado **Session Replay**, donde se muestra la grabaci√≥n de la sesi√≥n. | Se visualiza el **recorrido del usuario**, sus **acciones** y el **momento exacto del error en video**. |
| **6Ô∏è‚É£ Performance y trazas (tiempos de respuesta)** | Refrescar el **Home** y observar la carga de productos (`/products/`). | En **Insights ‚Üí Frontend ‚Üí Transactions** (parte inferior de la pantalla), seleccionar `/products/`. | Se muestra la **duraci√≥n del request**, la **latencia** y los **spans** del frontend y backend conectados. |
| **7Ô∏è‚É£ Alertas customizadas** | En **Sentry ‚Üí Detalles del proyecto ‚Üí Create Alert**<br>Crear regla siguiendo la imagen de referencia que esta mas abajo en el documento. | En **Issues ‚Üí Alerts**, se visualiza la regla creada y el historial de activaciones.<br>Adem√°s, se recibe la notificaci√≥n configurada (email/Slack). | Al provocar el error que cumpla la condici√≥n, **Sentry dispara la alerta** y te notifica.<br>El evento de activaci√≥n queda registrado en el historial de la regla. |

---

## Pantallas de referencias de UI de Sentry

### Settings de la alerta a crear en el paso 7
![Sentry final 1](SentryF1.png)

### Detalles del proyecto
![Sentry final 2](SentryF2.png)

### Detalles del frontend
![Sentry final 3](SentryF3.png)

### Detalles del backend
![Sentry final 4](SentryF4.png)

### Alertas creadas
![Sentry final 5](SentryF5.png)

---
# Video de demostracion

[Link del video](https://youtu.be/owDFjd3WVkY)

---

[‚¨ÖÔ∏è Anterior](../0.6.2/0.6.2.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../0.6.4/0.6.4.md)