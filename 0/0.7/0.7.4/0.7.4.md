> [0. Acerca del Grupo](../../0.md) ‚Ä∫ [0.7. Trabajo Individual (Patrones Cloud)](../0.7.md) ‚Ä∫ [0.7.4. Integrante 4](0.7.4.md)

# 0.7.4. Carolina Meza

## **Patron retry**

# Problema
En sistemas distribuidos, muchas fallas son transitorias (latencia, timeouts, errores 5xx, l√≠mites de tasa 429, p√©rdidas moment√°neas de red). Si el cliente falla ‚Äúde frente‚Äù o reintenta de inmediato y en masa, puede provocar tormentas de reintentos y agravar la indisponibilidad. El patr√≥n Retry aborda precisamente el manejo de fallas transitorias para mejorar estabilidad y disponibilidad sin saturar la dependencia.

# Soluci√≥n
La idea es envolver llamadas remotas con una pol√≠tica de reintentos que:
- Clasifica errores ‚Äúretryable‚Äù (p. ej., 408/429/5xx, errores de socket, lectura/escritura) versus no-reintentables (400, 401, 403, validaciones).
- Aplica exponential backoff con jitter (aleatoriedad) para evitar sincronizaci√≥n de clientes (herd effect).
- Establece l√≠mites (m√°x. intentos y backoff m√°ximo) y m√©tricas para observar el comportamiento.
- Se combina con timeouts y, si corresponde, circuit breaker para permitir recuperaci√≥n del servicio.
- AWS recomienda exponential backoff + jitter (full/equal jitter) y documenta por qu√© sin jitter los clientes se sincronizan; sus SDK ya incluyen estrategias est√°ndar/adaptivas.
- Google Cloud enfatiza que idempotencia y retries van de la mano; varios servicios exigen backoff exponencial y orientan a marcar qu√© operaciones son retryable.

# Casos de Aplicaci√≥n
**1. Fintech/e-commerce (Pagos y cobros)**
- **Problema:** confirmaciones de pago fallan por timeouts o 5xx del PSP.
- **Aplicaci√≥n:** reintentos con backoff + idempotency keys para evitar cargos duplicados; validar con m√©tricas de √©xito tras reintento. (Buenas pr√°cticas p√∫blicas de Google/Cloud Run y terceros sobre idempotencia en APIs como Stripe).

**2.APIs de plataforma de pagos/est√°ndares de conectividad**
- **Problema:**pol√≠ticas del proveedor exigen retry con backoff y proh√≠ben cachear errores.
- **Aplicaci√≥n:**  adoptar exponential backoff seg√∫n lineamientos de la plataforma para cumplir SLAs y no sobrecargar

## Aplicaci√≥n en su Proyecto Grupal:
**M√≥dulo Generaci√≥n de Playlist (Spotify):** Se implementa Retry con backoff exponencial + jitter para reintentar llamadas a la API de Spotify cuando ocurren fallas transitorias (timeouts, 429, 5xx). Antes, la creaci√≥n de playlists fallaba en picos de demanda; con Retry e idempotency-key para evitar duplicados, se espera elevar la tasa de √©xito ‚â• 99.5% y mantener p95 ‚â§ 1.2 s incluso ante rate limiting. La validaci√≥n se har√° con k6 (inyectando 1‚Äì3% de timeouts/429) y monitoreo de retries_total, retry_reason y latencia p95 en el dashboard.

**Integraci√≥n con Plataformas Externas (Spotify):** Se habilita Retry respetando Retry-After cuando apliquen l√≠mites de tasa, con circuit breaker para degradaciones sostenidas y fallback (una previsualizaci√≥n local) si la dependencia no responde. Se espera mantener la disponibilidad ‚â• 99.9% del flujo de ‚Äúguardar playlist‚Äù y que el breaker no permanezca abierto > 60 s. La validaci√≥n se har√° con fallas inyectadas (429/5xx) y monitoreo de breaker_state, retry_delay_ms_sum y tasa de √©xito post-retry.

## Desarrollo de C√≥digo y Demo
La siguiente estructura muestra c√≥mo se organiza la demo retry-http-demo, siguiendo una arquitectura por capas.
![alt text](image.png)

# Requisitos Previos
-Node.js v18+
-Docker

# Demo

**Ejecutar la demo**
1. Clonar el repo: https://github.com/ulima-arqsoft/arqui252-meza-beraun/retry-http-demo
2. Navegar a la carpeta del proyecto: 
cd retry-http-demo
3. Levantar los servicios con Docker Compose: docker compose up --build
4. Abrir en el navegador: http://localhost:3000/demo
![alt text](image-1.png)
5. Observar en consola de retry-api los logs de reintentos: 
[retry] intento #1 status=429 delay=1176ms
[retry] intento #2 status=503 delay=2390ms
6. La p√°gina muestra el resultado final: cuando se logra 200 OK del proveedor, ver√°s el JSON; si se agotan los intentos, ver√°s un mensaje de error final (502) indicando que el Retry fue insuficiente por fallas persistentes.


[‚¨ÖÔ∏è Anterior](../0.7.3/0.7.3.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../0.7.5/0.7.5.md)