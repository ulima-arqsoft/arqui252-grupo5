# 2.1.5. M√≥dulo 5

## Integraci√≥n con Plataformas Externas / Andrew Tamayo

### üéØ Alcance
Conectar y operar con Spotify (v1) y preparar interfaz agn√≥stica para Apple/YouTube Music.

### üåÄ Supuestos
- Se solicitan solo scopes m√≠nimos requeridos.
- Las llamadas respetan l√≠mites de tasa con backoff.

### ü§ñ Requisitos Funcionales

#### RF-IN-01 OAuth con alcance m√≠nimo
Scopes: perfil, biblioteca, crear playlist, recomendaciones.  
- **Aceptaci√≥n:** al autorizar, se guarda refresh token cifrado y fecha de expiraci√≥n.

#### RF-IN-02 Crear playlist en Spotify
T√≠tulo `LYRA ‚Ä¢ <Emoci√≥n> ‚Ä¢ <fecha>` y descripci√≥n con par√°metros + #LYRA.  
- **Aceptaci√≥n:** al ‚ÄúGuardar‚Äù, se crea playlist privada en la cuenta y se rellena con N pistas.

#### RF-IN-03 A√±adir/ordenar pistas
Inserci√≥n por lotes y orden por curva de energ√≠a.  
- **Aceptaci√≥n:** la secuencia respeta progresi√≥n seleccionada (progresivo u ‚Äúolas‚Äù).

#### RF-IN-04 Recomendaciones por features
Uso de `target_*` (valence, energy, tempo, danceability, acousticness).  
- **Aceptaci√≥n:** la respuesta se loguea (sin datos sensibles) para auditor√≠a.

#### RF-IN-05 Rate limiting y reintentos
Cola y backoff exponencial (x3) ante HTTP 429/5xx.  
- **Aceptaci√≥n:** tras 3 fallos, notifica al usuario y sugiere reintentar.

#### RF-IN-06 Estado de conexi√≥n
Mostrar ‚ÄúConectado/Reconectar‚Äù y √∫ltimo refresh.  
- **Aceptaci√≥n:** si el token expira, pide reautorizaci√≥n sin perder el flujo.

#### RF-IN-07 Sincronizaci√≥n de ediciones
Aplicar cambios hechos en LYRA a la playlist remota.  
- **Aceptaci√≥n:** al pulsar ‚ÄúSincronizar‚Äù, las diferencias se reflejan en Spotify.

#### RF-IN-08 Capa vendor-agnostic
Interfaz com√∫n `createPlaylist, addTracks, getTopArtists`.  
- **Aceptaci√≥n:** tests de contrato garantizan compatibilidad futura.

#### RF-IN-09 Manejo de errores/webhooks
Detectar expiraci√≥n/invalidaci√≥n de token y notificar.  
- **Aceptaci√≥n:** errores cr√≠ticos quedan registrados con c√≥digo y timestamp.

#### RF-IN-10 Privacidad de playlist
Bandera p√∫blico/privado (default: privado).  
- **Aceptaci√≥n:** el valor elegido se respeta al crear la playlist.
